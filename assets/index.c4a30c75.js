var z=Object.defineProperty;var g=Object.getOwnPropertySymbols;var p=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable;var f=(l,t,e)=>t in l?z(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e,_=(l,t)=>{for(var e in t||(t={}))p.call(t,e)&&f(l,e,t[e]);if(g)for(var e of g(t))y.call(t,e)&&f(l,e,t[e]);return l};var C=(l,t)=>{var e={};for(var s in l)p.call(l,s)&&t.indexOf(s)<0&&(e[s]=l[s]);if(l!=null&&g)for(var s of g(l))t.indexOf(s)<0&&y.call(l,s)&&(e[s]=l[s]);return e};var d=(l,t,e)=>(f(l,typeof t!="symbol"?t+"":t,e),e);import{l as A,y as w,j as E,a as j,g as m,s as k,A as x,h as O,S as F}from"./vendor.60f3588c.js";const N=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}};N();const v=()=>({width:window.innerWidth,height:window.innerHeight}),R=(l=250)=>{const[t,e]=A(v());return w(()=>{let s=0;const n=()=>{s&&clearTimeout(s),s=window.setTimeout(()=>{s=0,e(v())},l)};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),t};class U{constructor(t,e){d(this,"_cols");d(this,"_rows");d(this,"_cells");d(this,"_onChange",()=>{});d(this,"_playId",0);d(this,"_playInterval",200);this._cols=t,this._rows=e,this._cells=this.createCells()}createCells(t=this.length){return new Uint8Array(t)}setCells(t){this._cells=t,this._onChange()}setSize(t,e){const s=this.createCells(t*e),n=Math.min(t,this.cols),o=Math.min(e,this.rows);for(let i=0;i<o;i++)for(let r=0;r<n;r++)this._cells[r+i*this.cols]&&(s[r+i*t]=1);this._cols=t,this._rows=e,this.setCells(s)}get cols(){return this._cols}set cols(t){this.setSize(t,this.rows)}get rows(){return this._rows}set rows(t){this.setSize(this.cols,t)}get length(){return this._cols*this._rows}get liveLength(){return this._cells.reduce((t,e)=>t+e)}get deadLength(){return this.length-this.liveLength}set onChange(t){this._onChange=t}set playInterval(t){t!==this._playInterval&&(this._playInterval=t,this.isPlaying&&(this.pause(),this.play()))}get playInterval(){return this._playInterval}get isPlaying(){return!!this._playId}coord2index(t,e){const s=t+e*this.cols;return typeof this._cells[s]!="undefined"?s:-1}cellsForEach(t){for(let e=0;e<this._rows;e++)for(let s=0;s<this._cols;s++)t(s,e,!!this._cells[s+e*this._cols])}next(){const{cols:t,rows:e,_cells:s}=this,n=this.createCells();for(let o=0;o<e;o++)for(let i=0;i<t;i++){let r=0;o-1>=0&&(r+=i-1>=0?s[i-1+(o-1)*t]:0,r+=s[i+(o-1)*t],r+=i+1<t?s[i+1+(o-1)*t]:0),r+=i-1>=0?s[i-1+o*t]:0,r+=i+1<t?s[i+1+o*t]:0,o+1<e&&(r+=i-1>=0?s[i-1+(o+1)*t]:0,r+=s[i+(o+1)*t],r+=i+1<t?s[i+1+(o+1)*t]:0),n[i+o*t]=r===3||r===2&&s[i+o*t]?1:0}this._cells=n,this._onChange()}clear(){for(let t=0,e=this._cells.length;t<e;t++)this._cells[t]=0;this._onChange()}random(t=.2){for(let e=0,s=this._cells.length;e<s;e++)this._cells[e]=Math.random()<t?1:0;this._onChange()}getCell(t,e){const s=this.coord2index(t,e);return this._cells[s]}setCell(t,e,s){const n=this.coord2index(t,e);n>=0&&(this._cells[n]=s,this._onChange())}touchCell(t,e){this.setCell(t,e,1)}killCell(t,e){this.setCell(t,e,0)}toggleCell(t,e){const s=this.getCell(t,e);this.setCell(t,e,s?0:1)}touchCells(t){for(let e=0;e<t.length;e++){const[s,n]=t[e],o=this.coord2index(s,n);o>=0&&(this._cells[o]=1)}this._onChange()}createFromMatrix(t,e=0,s=0){const n=[];for(let o=0;o<t.length;o++)for(let i=0;i<t[o].length;i++)t[o][i]&&n.push([i+e,o+s]);this.touchCells(n)}play(){this.isPlaying||(this._playId=window.setInterval(()=>{this.next()},this.playInterval))}pause(){!this.isPlaying||(clearInterval(this._playId),this._playId=0)}togglePlay(){this.isPlaying?this.pause():this.play()}}const a=E,I=j,$=m(l=>{console.log("Canvas");const o=l,{onMount:t,onUnmount:e}=o,s=C(o,["onMount","onUnmount"]),n=k(null);return w(()=>{const i=n.current,r=i==null?void 0:i.getContext("2d");if(i&&r)return console.log("CanvasOnMount"),t&&t(i,r),()=>{console.log("CanvasOnUnMount"),e&&e(i,r)}},[]),a("canvas",_({ref:n},s))}),L=(l,t,e,s,n)=>{const o=e.cols*(s+n)+n,i=e.rows*(s+n)+n;l.width=o,l.height=i,t.fillStyle="black",t.fillRect(0,0,o,i),t.fillStyle="green",e.cellsForEach((r,M,P)=>{if(P){const b=n+r*(s+n),S=n+M*(s+n);t.fillRect(b,S,s,s)}})},V=m(({lifeGame:l,cellSize:t=4,gutter:e=1,style:s={}})=>{console.log("LifeGameCanvas");const n=x((i,r)=>{l.onChange=()=>{console.log("onChange"),L(i,r,l,t,e)},L(i,r,l,t,e)},[t]),o=x(()=>{l.onChange=()=>{}},[]);return a($,{onMount:n,onUnmount:o,style:s})}),h=new U(1,1),u=5,c=1,G=()=>{const l=R(),t=Math.ceil((l.width-c)/(u+c)),e=Math.ceil((l.height-c)/(u+c)),s=c+t*(u+c),n=c+e*(u+c);return{cols:t,rows:e,width:s,height:n}};function T(){console.log("App");const l=G();return O(()=>{console.log("useLayoutEffect in App");const t=h.length===1;h.setSize(l.cols,l.rows),t&&(h.random(),h.play())},[l]),I("div",{style:"position: absolute; left: 0; top: 0; width: 100%; height: 100%",children:[a(V,{lifeGame:h,cellSize:u,gutter:c,style:`width: ${l.width}px; height: ${l.height}px`}),I("div",{style:"position: absolute; bottom: 5px; right: 5px",children:[a("button",{onClick:()=>h.togglePlay(),children:"Play/Pause"}),a("button",{onClick:()=>h.next(),children:"Next"}),a("button",{onClick:()=>h.random(),children:"Random"}),a("button",{onClick:()=>{h.clear(),h.createFromMatrix([[0,1,0],[0,0,1],[1,1,1]],5,5)},children:"Glider"})]})]})}F(a(T,{}),document.getElementById("App"));
